<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.3;
  filter:Alpha(opacity=50);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <p class="x">æ›´å¤šè¯¾ç¨‹è¯·åŠ QQ1046877154ï¼Œå¾®ä¿¡loveu_110è·å–</p>
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                17è®²ç½‘ç»œä¼˜åŒ–ï¼ˆä¸‹ï¼‰ï¼šå¤§æ•°æ®ä¸‹ç½‘ç»œè¯¥å¦‚ä½•ç›‘æ§
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/6a/53/6a4229e833eb2c79dd670d9ee2c09753.jpg">


                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>é€šè¿‡ä¸Šä¸€æœŸçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹å¦‚ä½•æ‰“é€ ä¸€ä¸ªé«˜è´¨é‡çš„ç½‘ç»œå·²ç»æœ‰äº†ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ã€‚ä½†æ˜¯è¿™å°±è¶³å¤Ÿäº†å—ï¼Ÿå›æƒ³ä¸€ä¸‹ï¼Œä¸€ä¸ªç½‘ç»œè¯·æ±‚ä»æ‰‹æœºåˆ°åå°æœåŠ¡å™¨ï¼Œä¼šæ¶‰åŠåŸºç«™ã€å…‰çº¤ã€è·¯ç”±å™¨è¿™äº›ç¡¬ä»¶è®¾æ–½ï¼Œä¹Ÿä¼šè·Ÿè¿è¥å•†å’ŒæœåŠ¡å™¨æœºæˆ¿æœ‰å…³ã€‚</p><p>ä¸è®ºæ˜¯åŸºç«™æ•…éšœã€å…‰çº¤è¢«æŒ–æ–­ã€è¿è¥å•†æŒŸæŒï¼Œè¿˜æ˜¯æˆ‘ä»¬çš„æœºæˆ¿ã€CDNæœåŠ¡å•†å‡ºç°æ•…éšœï¼Œéƒ½æœ‰å¯èƒ½ä¼šå¼•èµ·ç”¨æˆ·ç½‘ç»œå‡ºç°é—®é¢˜ã€‚ä½ æœ‰æ²¡æœ‰æ„Ÿè§‰çº¿ä¸Šç»å¸¸çªå‘å„ç§åƒå¥‡ç™¾æ€ªçš„ç½‘ç»œé—®é¢˜ï¼Œå¾ˆå¤šå…¬å¸çš„è¿ç»´äººå‘˜æ¯å¤©è¿‡å¾—èƒ†æˆ˜å¿ƒæƒŠã€ç–²äºå¥”å‘½ã€‚</p><p>â€œå–„è‰¯â€çš„æ•…éšœè¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åè«åå…¶å¦™å°±å¥½äº†ï¼Œâ€œé¡½å›ºâ€çš„æ•…éšœéš¾ä»¥å®šä½ä¹Ÿéš¾ä»¥è§£å†³ã€‚è¿™äº›æ•…éšœç©¶ç«Ÿæ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Ÿä¸ºä»€ä¹ˆçªç„¶å°±æ¢å¤äº†ï¼Ÿå®ƒä»¬å½±å“äº†å¤šå°‘ç”¨æˆ·ã€å“ªäº›ç”¨æˆ·ï¼Ÿæƒ³è¦è§£å†³è¿™äº›é—®é¢˜ç¦»ä¸å¼€é«˜è´¨é‡çš„ç½‘ç»œï¼Œè€Œé«˜è´¨é‡çš„ç½‘ç»œåˆç¦»ä¸å¼€å¼ºå¤§çš„ç›‘æ§ã€‚ä»Šå¤©æˆ‘ä»¬å°±ä¸€èµ·æ¥çœ‹çœ‹ç½‘ç»œè¯¥å¦‚ä½•ç›‘æ§å§ã€‚</p><h2>ç§»åŠ¨ç«¯ç›‘æ§</h2><p>å¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å„ç§å„æ ·çš„ç½‘ç»œè¯·æ±‚ã€‚å³ä½¿ä½¿ç”¨äº†OkHttpç½‘ç»œåº“ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰ä¸€äº›å¼€å‘äººå‘˜æˆ–è€…ç¬¬ä¸‰æ–¹ç»„ä»¶ä½¿ç”¨äº†ç³»ç»Ÿçš„ç½‘ç»œåº“ã€‚é‚£åº”è¯¥å¦‚ä½•ç»Ÿä¸€çš„ç›‘æ§å®¢æˆ·ç«¯çš„æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚å‘¢ï¼Ÿ</p><p><strong>1. å¦‚ä½•ç›‘æ§ç½‘ç»œ</strong></p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•ï¼šæ’æ¡©ã€‚</strong></p><p>ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„è¿˜æ˜¯æ’æ¡©ã€‚360å¼€æºçš„æ€§èƒ½ç›‘æ§å·¥å…·<a href="https://github.com/Qihoo360/ArgusAPM">ArgusAPM</a>å°±æ˜¯åˆ©ç”¨Aspectåˆ‡æ¢æ’æ¡©ï¼Œå®ç°ç›‘æ§ç³»ç»Ÿå’ŒOkHttpç½‘ç»œåº“çš„è¯·æ±‚ã€‚</p><!-- [[[read_end]]] --><p>ç³»ç»Ÿç½‘ç»œåº“çš„æ’æ¡©å®ç°å¯ä»¥å‚è€ƒ<a href="https://github.com/Qihoo360/ArgusAPM/blob/bc03d63c65019cd3ffe2cbef9533c9228b3f2381/argus-apm/argus-apm-aop/src/main/java/com/argusapm/android/aop/TraceNetTrafficMonitor.java">TraceNetTrafficMonitor</a>ï¼Œä¸»è¦åˆ©ç”¨<a href="http://www.shouce.ren/api/spring2.5/ch06s02.html">Aspect</a>çš„åˆ‡é¢åŠŸèƒ½ï¼Œå…³äºOkHttpçš„æ‹¦æˆªå¯ä»¥å‚è€ƒ<a href="https://github.com/Qihoo360/ArgusAPM/blob/bc03d63c65019cd3ffe2cbef9533c9228b3f2381/argus-apm/argus-apm-okhttp/src/main/java/com/argusapm/android/okhttp3/OkHttp3Aspect.java">OkHttp3Aspect</a>ï¼Œå®ƒä¼šæ›´åŠ ç®€å•ä¸€äº›ï¼Œå› ä¸ºOkHttpæœ¬èº«å°±æœ‰ä»£ç†æœºåˆ¶ã€‚</p><pre><code>@Pointcut(&quot;call(public okhttp3.OkHttpClient build())&quot;)
public void build() {
}

@Around(&quot;build()&quot;)
public Object aroundBuild(ProceedingJoinPoint joinPoint) throws Throwable {
    Object target = joinPoint.getTarget();
    if (target instanceof OkHttpClient.Builder &amp;&amp;    Client.isTaskRunning(ApmTask.TASK_NET)) {
        OkHttpClient.Builder builder = (OkHttpClient.Builder) target;
        builder.addInterceptor(new NetWorkInterceptor());
    }
    return joinPoint.proceed();
}
</code></pre><p>æ’æ¡©çš„æ–¹æ³•çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†æ˜¯å¹¶ä¸å…¨é¢ã€‚å¦‚æœä½¿ç”¨çš„ä¸æ˜¯ç³»ç»Ÿå’ŒOkHttpç½‘ç»œåº“ï¼Œåˆæˆ–è€…ä½¿ç”¨äº†Nativeä»£ç çš„ç½‘ç»œè¯·æ±‚ï¼Œéƒ½æ— æ³•ç›‘æ§åˆ°ã€‚</p><p><strong>ç¬¬äºŒç§æ–¹æ³•ï¼šNative Hookã€‚</strong></p><p>è·ŸI/Oç›‘æ§ä¸€æ ·ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æƒ³åˆ°äº†å¼ºå¤§çš„Native Hookã€‚ç½‘ç»œç›¸å…³çš„æˆ‘ä»¬ä¸€èˆ¬ä¼šHookä¸‹é¢å‡ ä¸ªæ–¹æ³• ï¼š</p><ul>
<li>
<p>è¿æ¥ç›¸å…³ï¼šconnectã€‚</p>
</li>
<li>
<p>å‘é€æ•°æ®ç›¸å…³ï¼šsendå’Œsendtoã€‚</p>
</li>
<li>
<p>æ¥æ”¶æ•°æ®ç›¸å…³ï¼šrecvå’Œrecvfromã€‚</p>
</li>
</ul><p>Androidåœ¨ä¸åŒç‰ˆæœ¬Socketçš„é€»è¾‘ä¼šæœ‰é‚£ä¹ˆä¸€äº›å·®å¼‚ï¼Œä»¥Android 7.0ä¸ºä¾‹ï¼ŒSocketå»ºè¿çš„å †æ ˆå¦‚ä¸‹ï¼š</p><pre><code>java.net.PlainSocketImpl.socketConnect(Native Method)
java.net.AbstractPlainSocketImpl.doConnect
java.net.AbstractPlainSocketImpl.connectToAddress
java.net.AbstractPlainSocketImpl.connect
java.net.SocksSocketImpl.connect
java.net.Socket.connect
com.android.okhttp.internal.Platform.connectSocket
com.android.okhttp.Connection.connectSocket
com.android.okhttp.Connection.connect
</code></pre><p>â€œsocketConnectâ€æ–¹æ³•å¯¹åº”çš„Nativeæ–¹æ³•å®šä¹‰åœ¨<a href="http://androidxref.com/7.0.0_r1/xref/libcore/ojluni/src/main/native/PlainSocketImpl.c">PlainSocketImpl.c</a>ï¼ŒæŸ¥çœ‹<a href="http://androidxref.com/7.0.0_r1/xref/libcore/ojluni/src/main/native/openjdksub.mk">makefile</a>å¯ä»¥çŸ¥é“å®ƒä»¬ä¼šç¼–è¯‘åœ¨libopenjdk.soä¸­ã€‚ä¸è¿‡åœ¨Android 8.0ï¼Œæ•´ä¸ªè°ƒç”¨æµç¨‹åˆå®Œå…¨æ”¹å˜äº†ã€‚ä¸ºäº†å…¼å®¹æ€§è€ƒè™‘ï¼Œæˆ‘ä»¬ç›´æ¥PLT Hookå†…å­˜çš„æ‰€æœ‰soï¼Œä½†æ˜¯éœ€è¦æ’é™¤æ‰Socketå‡½æ•°æœ¬èº«æ‰€åœ¨çš„libc.soã€‚</p><pre><code>hook_plt_method_all_lib(&quot;libc.so&quot;, &quot;connect&quot;, (hook_func) &amp;create_hook);
hook_plt_method_all_lib(&quot;libc.so, &quot;send&quot;, (hook_func) &amp;send_hook);
hook_plt_method_all_lib(&quot;libc.so&quot;, &quot;recvfrom&quot;, (hook_func) &amp;recvfrom_hook);
...
</code></pre><p>è¿™ç§åšæ³•ä¸å¥½çš„åœ°æ–¹åœ¨äºä¼šæŠŠç³»ç»Ÿçš„Local Socketä¹ŸåŒæ—¶æ¥ç®¡äº†ï¼Œéœ€è¦åœ¨ä»£ç ä¸­å¢åŠ è¿‡æ»¤æ¡ä»¶ã€‚åœ¨ä»Šå¤©çš„Sampleä¸­ï¼Œæˆ‘ç»™ä½ æä¾›äº†ä¸€å¥—ç®€å•çš„å®ç°ã€‚å…¶å®æ— è®ºæ˜¯å“ªä¸€ç§Hookï¼Œå¦‚æœç†Ÿç»ƒæŒæ¡ä¹‹åä½ ä¼šå‘ç°å®ƒå¹¶ä¸å›°éš¾ã€‚æˆ‘ä»¬éœ€è¦è€å¿ƒåœ°å¯»æ‰¾ï¼Œæ¢³ç†æ¸…æ¥šæ•´ä¸ªè°ƒç”¨æµç¨‹ã€‚</p><p><strong>ç¬¬ä¸‰ç§æ–¹æ³•ï¼šç»Ÿä¸€ç½‘ç»œåº“ã€‚</strong></p><p>å°½ç®¡æ‹¿åˆ°äº†æ‰€æœ‰çš„ç½‘ç»œè°ƒç”¨ï¼Œæƒ³æƒ³ä¼šæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯å‘¢ï¼Ÿæ¨¡æ‹Ÿç½‘ç»œæ•°æ®ã€ç»Ÿè®¡åº”ç”¨æµé‡ï¼Œæˆ–è€…æ˜¯å•ç‹¬ä»£ç†WebViewçš„ç½‘ç»œè¯·æ±‚ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/7c/4c/7cecaa1134f078228598d9b3beec6b4c.png" alt=""></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä¼šéå¸¸å…³å¿ƒç¬¬ä¸‰æ–¹çš„ç½‘ç»œè¯·æ±‚æƒ…å†µï¼Œè€Œå¯¹äºæˆ‘ä»¬åº”ç”¨è‡ªèº«çš„ç½‘ç»œè¯·æ±‚ï¼Œæœ€å¥½çš„ç›‘æ§æ–¹æ³•è¿˜æ˜¯ç»Ÿä¸€ç½‘ç»œåº“ã€‚<strong>ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æ’æ¡©å’ŒHookè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç›‘æ§åº”ç”¨ä¸­æœ‰å“ªäº›åœ°æ–¹ä½¿ç”¨äº†å…¶ä»–çš„ç½‘ç»œåº“ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ç»Ÿä¸€ç½‘ç»œåº“ã€‚</strong></p><p>åœ¨ä¸Šä¸€æœŸå†…å®¹ä¸­ï¼Œæˆ‘è¯´è¿‡â€œç½‘ç»œè´¨é‡ç›‘æ§â€åº”è¯¥æ˜¯å®¢æˆ·ç«¯ç½‘ç»œåº“ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æ¨¡å—ï¼Œå®ƒä¹Ÿä¼šè·Ÿå¤§ç½‘ç»œå¹³å°çš„æ¥å…¥æœåŠ¡å…±åŒåä½œã€‚é€šè¿‡ç»Ÿä¸€ç½‘ç»œåº“çš„æ–¹å¼ï¼Œçš„ç¡®æ— æ³•ç›‘æ§åˆ°ç¬¬ä¸‰æ–¹çš„ç½‘ç»œè¯·æ±‚ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ‹¿åˆ°åº”ç”¨çš„æ•´ä½“æµé‡ä½¿ç”¨æƒ…å†µï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚</p><p><strong>2. å¦‚ä½•ç›‘æ§æµé‡</strong></p><p>åº”ç”¨æµé‡ç›‘æ§çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œä¸€èˆ¬é€šè¿‡TrafficStatsç±»ã€‚TrafficStateæ˜¯Android API 8åŠ å…¥çš„æ¥å£ï¼Œç”¨äºè·å–æ•´ä¸ªæ‰‹æœºæˆ–è€…æŸä¸ªUIDä»å¼€æœºç®—èµ·çš„ç½‘ç»œæµé‡ã€‚è‡³äºå¦‚ä½•ä½¿ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒFacebookä¸€ä¸ªå†å²æ¯”è¾ƒä¹…è¿œçš„å¼€æºåº“<a href="https://github.com/facebook/network-connection-class">network-connection-class</a>ã€‚</p><pre><code>getMobileRxBytes()        //ä»å¼€æœºå¼€å§‹Mobileç½‘ç»œæ¥æ”¶çš„å­—èŠ‚æ€»æ•°ï¼Œä¸åŒ…æ‹¬Wifi
getTotalRxBytes()         //ä»å¼€æœºå¼€å§‹æ‰€æœ‰ç½‘ç»œæ¥æ”¶çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬Wifi
getMobileTxBytes()        //ä»å¼€æœºå¼€å§‹Mobileç½‘ç»œå‘é€çš„å­—èŠ‚æ€»æ•°ï¼Œä¸åŒ…æ‹¬Wifi
getTotalTxBytes()         //ä»å¼€æœºå¼€å§‹æ‰€æœ‰ç½‘ç»œå‘é€çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬Wifi
</code></pre><p>å®ƒçš„å®ç°åŸç†å…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨Linuxå†…æ ¸çš„ç»Ÿè®¡æ¥å£ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯ä¸‹é¢ä¸¤ä¸ªprocæ¥å£ã€‚</p><pre><code>// statsæ¥å£æä¾›å„ä¸ªuidåœ¨å„ä¸ªç½‘ç»œæ¥å£ï¼ˆwlan0, ppp0ç­‰ï¼‰çš„æµé‡ä¿¡æ¯
/proc/net/xt_qtaguid/stats
// iface_stat_fmtæ¥å£æä¾›å„ä¸ªæ¥å£çš„æ±‡æ€»æµé‡ä¿¡æ¯
proc/net/xt_qtaguid/iface_stat_fmt
</code></pre><p>TrafficStatsçš„å·¥ä½œåŸç†æ˜¯è¯»å–procï¼Œå¹¶å°†ç›®æ ‡UIDä¸‹é¢æ‰€æœ‰ç½‘ç»œæ¥å£çš„æµé‡ç›¸åŠ ã€‚ä½†å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨TrafficStatsæ¥å£ï¼Œè€Œæ˜¯è‡ªå·±è§£æprocæ–‡ä»¶å‘¢ï¼Ÿé‚£æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸åŒç½‘ç»œæ¥å£ä¸‹çš„æµé‡ï¼Œä»è€Œè®¡ç®—å‡ºWiFiã€2G/3G/4Gã€VPNã€çƒ­ç‚¹å…±äº«ã€WiFi P2Pç­‰ä¸åŒç½‘ç»œçŠ¶æ€ä¸‹çš„æµé‡ã€‚</p><p>ä¸è¿‡éå¸¸é—æ†¾çš„æ˜¯ï¼ŒAndroid 7.0ä¹‹åç³»ç»Ÿå·²ç»ä¸è®©æˆ‘ä»¬ç›´æ¥å»è¯»å–statsæ–‡ä»¶ï¼Œé˜²æ­¢å¼€å‘è€…å¯ä»¥æ‹¿åˆ°å…¶ä»–åº”ç”¨çš„æµé‡ä¿¡æ¯ï¼Œå› æ­¤åªèƒ½é€šè¿‡TrafficStatsæ‹¿åˆ°è‡ªå·±åº”ç”¨çš„æµé‡ä¿¡æ¯ã€‚</p><p>é™¤äº†æµé‡ä¿¡æ¯ï¼Œé€šè¿‡/proc/netæˆ‘ä»¬è¿˜å¯ä»¥æ‹¿åˆ°å¤§é‡ç½‘ç»œç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ç½‘ç»œä¿¡å·å¼ºåº¦ã€ç”µå¹³å¼ºåº¦ç­‰ã€‚Androidæ‰‹æœºè·ŸiPhoneéƒ½æœ‰ä¸€ä¸ªç½‘ç»œæµ‹è¯•æ¨¡å¼ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚</p><ul>
<li>
<p>iPhoneï¼šæ‰“å¼€æ‹¨å·ç•Œé¢ï¼Œè¾“å…¥â€œ*3001#12345#*â€ï¼Œç„¶åæŒ‰æ‹¨å·é”®ã€‚</p>
</li>
<li>
<p>Androidæ‰‹æœºï¼šæ‰“å¼€æ‹¨å·ç•Œé¢ï¼Œè¾“å…¥â€œ*#*#4636#*#*â€ï¼Œç„¶åæŒ‰æ‹¨å·é”®ï¼ˆå¯è¿›å…¥å·¥ç¨‹æµ‹è¯•æ¨¡å¼ï¼Œéƒ¨åˆ†ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒï¼‰ã€‚</p>
</li>
</ul><p><img src="https://static001.geekbang.org/resource/image/e6/59/e64bb9e4012132286b787483c01b5959.png" alt=""></p><p>ä¸ºä»€ä¹ˆç³»ç»Ÿå¯ä»¥åˆ¤æ–­æ­¤æ—¶çš„WiFiâ€œå·²è¿æ¥ï¼Œä½†æ— æ³•è®¿é—®äº’è”ç½‘â€ï¼Ÿå›æƒ³ä¸€ä¸‹ä¸“æ ç¬¬15æœŸæˆ‘ç»™ä½ ç•™çš„è¯¾åä½œä¸šï¼š</p><blockquote>
<p>iPhoneçš„æ— çº¿ç½‘ç»œåŠ©ç†ã€å°ç±³å’Œä¸€åŠ çš„è‡ªé€‚åº”WLANå®ƒä»¬åœ¨æ£€æµ‹WiFiä¸ç¨³å®šæ—¶ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç§»åŠ¨ç½‘ç»œã€‚é‚£è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å®ç°ä¾¦æµ‹ï¼Œå¦‚ä½•åŒºåˆ†æ˜¯åº”ç”¨åå°æœåŠ¡å™¨å‡ºé—®é¢˜è¿˜æ˜¯WiFiæœ¬èº«æœ‰é—®é¢˜å‘¢ï¼Ÿ</p>
</blockquote><p>æˆ‘çœ‹äº†ä¸€ä¸‹åŒå­¦ä»¬çš„å›å¤ï¼Œå¤§éƒ¨åˆ†åŒå­¦è®¤ä¸ºéœ€è¦è®¿é—®ä¸€ä¸ªå…¬ç½‘IPçš„æ–¹å¼ã€‚å…¶å®å¯¹äºæ‰‹æœºå‚å•†æ¥è¯´æ ¹æ®ä¸éœ€è¦ï¼Œå®ƒåœ¨åº•å±‚å¯ä»¥æ‹¿åˆ°çš„ä¿¡æ¯æœ‰å¾ˆå¤šã€‚</p><ul>
<li>
<p>ç½‘å¡é©±åŠ¨å±‚ä¿¡æ¯ã€‚å¦‚å°„é¢‘å‚æ•°ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­WiFiçš„ä¿¡å·å¼ºåº¦ï¼›ç½‘å¡æ•°æ®åŒ…é˜Ÿåˆ—é•¿åº¦ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ç½‘ç»œæ˜¯å¦æ‹¥å¡ã€‚</p>
</li>
<li>
<p>åè®®æ ˆä¿¡æ¯ã€‚ä¸»è¦æ˜¯è·å–æ•°æ®åŒ…å‘é€ã€æ¥æ”¶ã€æ—¶å»¶å’Œä¸¢åŒ…ç­‰ä¿¡æ¯ã€‚</p>
</li>
</ul><p>å¦‚æœä¸€ä¸ªWiFiå‘é€è¿‡æ•°æ®åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ°ä»»ä½•çš„ACKå›åŒ…ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆæ­¥åˆ¤æ–­å½“å‰çš„WiFiæ˜¯æœ‰é—®é¢˜çš„ã€‚è¿™æ ·ç³»ç»Ÿå¯ä»¥çŸ¥é“å½“å‰WiFiå¤§æ¦‚ç‡æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒå¹¶ä¸å…³å¿ƒæ˜¯ä¸æ˜¯å› ä¸ºæˆ‘ä»¬åå°æœåŠ¡å™¨å‡ºé—®é¢˜å¯¼è‡´çš„ã€‚</p><h2>å¤§ç½‘ç»œå¹³å°ç›‘æ§</h2><p>å‰é¢æˆ‘è®²äº†ä¸€äº›åº”ç”¨ç½‘ç»œè¯·æ±‚å’Œæµé‡çš„ç›‘æ§æ–¹æ³•ï¼Œä½†æ˜¯è¿˜æ²¡çœŸæ­£å›ç­”åº”è¯¥å¦‚ä½•å»æ‰“é€ ä¸€å¥—å¼ºå¤§çš„ç½‘ç»œç›‘æ§ä½“ç³»ã€‚è·Ÿç½‘ç»œä¼˜åŒ–ä¸€æ ·ï¼Œç½‘ç»œç›‘æ§ä¸æ˜¯å®¢æˆ·ç«¯å¯ä»¥å•ç‹¬å®Œæˆçš„ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ªå¤§ç½‘ç»œå¹³å°çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p><p>ä¸è¿‡é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨å®¢è§‚ä¸Šæ‰¿è®¤è¿™ä»¶äº‹æƒ…åšèµ·æ¥å¹¶ä¸å®¹æ˜“ï¼Œå› ä¸ºç½‘ç»œé—®é¢˜ä¼šå­˜åœ¨ä¸‹é¢è¿™äº›ç‰¹ç‚¹ï¼š</p><ul>
<li>
<p>å®æ—¶æ€§ã€‚éƒ¨åˆ†ç½‘ç»œé—®é¢˜è¿‡æ—¶ä¸å€™ï¼Œå¯èƒ½å¾ˆå¿«å°±ä¸¢å¤±ç°åœºã€‚</p>
</li>
<li>
<p>å¤æ‚æ€§ã€‚å¯èƒ½è·Ÿå›½å®¶ã€åœ°åŒºã€è¿è¥å•†ã€ç‰ˆæœ¬ã€ç³»ç»Ÿã€æœºå‹ã€CDNéƒ½æœ‰å…³ï¼Œä¸ä»…ç»´åº¦å¤šï¼Œæ•°æ®é‡ä¹Ÿå·¨å¤§ã€‚</p>
</li>
<li>
<p>é“¾è·¯é•¿ã€‚æ•´ä¸ªè¯·æ±‚é“¾æ¡éå¸¸é•¿ï¼Œå®¢æˆ·ç«¯æ•…éšœã€ç½‘é“¾éšœç»œã€æœåŠ¡æ•…éšœéƒ½æœ‰å¯èƒ½ã€‚</p>
</li>
</ul><p>å› æ­¤æ‰€è°“çš„ç½‘ç»œç›‘æ§ï¼Œå¹¶ä¸èƒ½ä¿è¯å¯ä»¥æ˜ç¡®æ‰¾åˆ°æ•…éšœçš„åŸå› ã€‚è€Œæˆ‘ä»¬ç›®æ ‡æ˜¯å¸Œæœ›å¿«é€Ÿå‘ç°é—®é¢˜ï¼Œå°½å¯èƒ½æ‹¿åˆ°æ›´å¤šçš„è¾…åŠ©ä¿¡æ¯ï¼ŒååŠ©æˆ‘ä»¬æ›´å®¹æ˜“åœ°æ’æŸ¥é—®é¢˜ã€‚</p><p>ä¸‹é¢æˆ‘åˆ†åˆ«ä»å®¢æˆ·ç«¯ä¸æ¥å…¥å±‚çš„è§’åº¦å‡ºå‘ï¼Œä¸€èµ·æ¥çœ‹çœ‹å“ªäº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°å‘ç°é—®é¢˜å’Œè§£å†³é—®é¢˜ã€‚</p><p><strong>1. å®¢æˆ·ç«¯ç›‘æ§</strong></p><p>å®¢æˆ·ç«¯çš„ç›‘æ§ä½¿ç”¨ç»Ÿç½‘ç»œåº“çš„æ–¹å¼ï¼Œä½ å¯ä»¥æƒ³æƒ³æˆ‘ä»¬éœ€è¦å…³å¿ƒå“ªäº›å†…å®¹ï¼š</p><ul>
<li>
<p>æ—¶å»¶ã€‚ä¸€èˆ¬æˆ‘ä»¬æ¯”è¾ƒå…³å¿ƒæ¯æ¬¡è¯·æ±‚çš„DNSæ—¶é—´ã€å»ºè¿æ—¶é—´ã€é¦–åŒ…æ—¶é—´ã€æ€»æ—¶é—´ç­‰ï¼Œä¼šæœ‰ç±»ä¼¼1ç§’å¿«å¼€ç‡ã€2ç§’å¿«å¼€ç‡è¿™äº›æŒ‡æ ‡ã€‚</p>
</li>
<li>
<p>ç»´åº¦ã€‚ç½‘ç»œç±»å‹ã€å›½å®¶ã€çœä»½ã€åŸå¸‚ã€è¿è¥å•†ã€ç³»ç»Ÿã€å®¢æˆ·ç«¯ç‰ˆæœ¬ã€æœºå‹ã€è¯·æ±‚åŸŸåç­‰ï¼Œè¿™äº›ç»´åº¦ä¸»è¦ç”¨äºåˆ†æé—®é¢˜ã€‚</p>
</li>
<li>
<p>é”™è¯¯ã€‚DNSå¤±è´¥ã€è¿æ¥å¤±è´¥ã€è¶…æ—¶ã€è¿”å›é”™è¯¯ç ç­‰ï¼Œä¼šæœ‰DNSå¤±è´¥ç‡ã€è¿æ¥å¤±è´¥ç‡ã€ç½‘ç»œè®¿é—®çš„å¤±è´¥ç‡è¿™äº›æŒ‡æ ‡ã€‚</p>
</li>
</ul><p>é€šè¿‡è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ±‡æ€»å‡ºåº”ç”¨çš„ç½‘ç»œè®¿é—®å¤§å›¾ã€‚ä¾‹å¦‚åœ¨å›½å†…æ— è®ºæˆ‘ä»¬å»åˆ°å“ªé‡Œéƒ½ä¼šé—®æœ‰æ²¡æœ‰WiFiï¼ŒWiFiçš„å æ¯”ä¼šè¶…è¿‡50%ã€‚è¿™å…¶å®è¿œè¿œæ¯”æµ·å¤–é«˜ï¼Œåœ¨å°åº¦WiFiçš„å æ¯”ä»…ä»…åªæœ‰15%å·¦å³ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/62/e1/62926bf186ce0c4898419aa549ce77e1.png" alt=""></p><p>åŒæ ·çš„æˆ‘ä»¬åˆ†ç‰ˆæœ¬ã€åˆ†å›½å®¶ã€åˆ†è¿è¥å•†ã€åˆ†åŸŸåç­‰å„ç§å„æ ·çš„ç»´åº¦ï¼Œæ¥ç›‘æ§æˆ‘ä»¬çš„æ—¶å»¶å’Œé”™è¯¯è¿™äº›è®¿é—®æŒ‡æ ‡ã€‚</p><p>ç”±äºç»´åº¦å¤ªå¤šï¼Œæ¯ä¸ªç»´åº¦çš„å–å€¼èŒƒå›´ä¹Ÿå¾ˆå¹¿ï¼Œå¦‚æœæ˜¯å®æ—¶è®¡ç®—æ•´ä¸ªæ•°æ®é‡ä¼šéå¸¸éå¸¸å¤§ã€‚å¯¹äºå®¢æˆ·ç«¯çš„ä¸ŠæŠ¥æ•°æ®ï¼Œå¾®ä¿¡å¯ä»¥åšåˆ°åˆ†é’Ÿçº§åˆ«çš„ç›‘æ§æŠ¥è­¦ã€‚ä¸è¿‡ä¸ºäº†è¿ç®—ç®€å•æˆ‘ä»¬ä¼šæŠ›å¼ƒUVï¼Œåªè®¡ç®—æ¯ä¸€åˆ†é’Ÿéƒ¨åˆ†ç»´åº¦çš„PVã€‚</p><p><strong>2. æ¥å…¥å±‚ç›‘æ§</strong></p><p>å®¢æˆ·ç«¯ç›‘æ§çš„æ•°æ®ä¼šæ¯”æ¥å…¥å±‚æ›´åŠ ä¸°å¯Œï¼Œå› ä¸ºæœ‰å¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†æ•°æ®è¿˜æ²¡åˆ°è¾¾æ¥å…¥å±‚å°±å·²ç»è¢«æ‰“å›ï¼Œä¾‹å¦‚è¿è¥å•†åŠ«æŒçš„æƒ…å†µã€‚</p><p><img src="https://static001.geekbang.org/resource/image/13/f3/133c91b1f38a8a8dc23fff33475b13f3.png" alt=""></p><p>ä½†æ˜¯æ¥å…¥å±‚çš„æ•°æ®ç›‘æ§è¿˜æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä¸»è¦çš„åŸå› æ˜¯ï¼š</p><ul>
<li>
<p>å®æ—¶æ€§ã€‚å®¢æˆ·ç«¯å¦‚æœä½¿ç”¨ç§’çº§çš„å®æ—¶ä¸ŠæŠ¥ï¼Œå¯¹ç”¨æˆ·æ€§èƒ½å½±å“ä¼šæ¯”è¾ƒå¤§ã€‚æœåŠ¡ç«¯å°±ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¾ˆå®¹æ˜“å¯ä»¥åšåˆ°ç§’çº§çš„ç›‘æ§ã€‚</p>
</li>
<li>
<p>å¯é æ€§ã€‚å¦‚æœå‡ºç°æŸäº›ç½‘ç»œé—®é¢˜ï¼Œå®¢æˆ·ç«¯çš„æ•°æ®ä¸ŠæŠ¥é€šé“å¯èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œå®¢æˆ·ç«¯çš„æ•°æ®ä¸å®Œå…¨å¯é ã€‚</p>
</li>
</ul><p>é‚£æ¥å…¥å±‚åº”è¯¥å…³å¿ƒå“ªäº›æ•°æ®å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒå…³å¿ƒæœåŠ¡çš„å…¥å£å’Œå‡ºå£æµé‡ã€æœåŠ¡ç«¯çš„å¤„ç†æ—¶å»¶ã€é”™è¯¯ç‡ç­‰ã€‚</p><p><strong>3. ç›‘æ§æŠ¥è­¦</strong></p><p>æ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æ¥å…¥å±‚çš„ç›‘æ§ï¼Œå®ƒä»¬éƒ½æ˜¯åˆ†å±‚çš„ã€‚</p><ul>
<li>
<p>å®æ—¶ç›‘æ§ã€‚ç§’çº§æˆ–è€…åˆ†é’Ÿçº§åˆ«çš„å®æ—¶ç›‘æ§çš„ä¿¡æ¯ä¼šç›¸æ¯”å°‘ä¸€äº›ï¼Œä¾‹å¦‚åªæœ‰è®¿é—®é‡ï¼ˆPVï¼‰ã€é”™è¯¯ç‡ï¼Œæ²¡æœ‰å»æ‹†åˆ†å‡ ç™¾ä¸ªä¸Šåƒä¸ªç»´åº¦ï¼Œä¹Ÿæ²¡æœ‰ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼ˆUVï¼‰ï¼Œå®æ—¶ç›‘æ§çš„ç›®çš„æ˜¯æœ€å¿«é€Ÿåº¦å‘ç°é—®é¢˜ã€‚</p>
</li>
<li>
<p>ç¦»çº¿ç›‘æ§ã€‚å°æ—¶æˆ–è€…å¤©çº§åˆ«çš„ç›‘æ§æˆ‘ä»¬å¯ä»¥æ‹“å±•å‡ºå…¨éƒ¨çš„ç»´åº¦æ¥åšç›‘æ§ï¼Œå®ƒçš„ç›®çš„æ˜¯åœ¨ç›‘æ§çš„åŒæ—¶ï¼Œå¯ä»¥æ›´å¥½åœ°åœˆå‡ºé—®é¢˜çš„èŒƒå›´ã€‚</p>
</li>
</ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•æ ¹æ®å®¢æˆ·ç«¯ã€å›½å®¶ä»¥åŠè¿è¥å•†ç»´åº¦åˆ†æçš„ç¤ºä¾‹ã€‚å½“ç„¶æ›´å¤šçš„æ—¶å€™æ˜¯æŸä¸€ä¸ªæœåŠ¡å‡ºç°é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™é€šè¿‡åˆ†åŸŸåæˆ–è€…é”™è¯¯ç å°±å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰¾åˆ°åŸå› ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/54/86/54901a205444cce26ff1cfb6c802ac86.png" alt=""></p><p>é‚£åœ¨ç›‘æ§çš„åŒæ—¶å¦‚ä½•å®ç°å‡†ç¡®çš„è‡ªåŠ¨åŒ–æŠ¥è­¦å‘¢ï¼Ÿè¿™åŒæ ·ä¹Ÿæ˜¯ä¸šç•Œçš„ä¸€ä¸ªéš¾é¢˜ï¼Œå®ƒçš„éš¾åº¦åœ¨äºå¦‚æœè§„åˆ™è¿‡äºè‹›åˆ»ï¼Œå¯èƒ½ä¼šå‡ºç°æ¼æŠ¥ï¼›å¦‚æœè¿‡äºå®½æ¾ï¼Œå¯èƒ½ä¼šå‡ºç°å¤ªå¤šçš„è¯¯æŠ¥ã€‚</p><p>ä¸šç•Œä¸€èˆ¬å­˜åœ¨ä¸¤ç§æŠ¥è­¦çš„ç®—æ³•ï¼Œä¸€å¥—æ˜¯åŸºäºè§„åˆ™ï¼Œä¾‹å¦‚å¤±è´¥ç‡ä¸å†å²æ•°æ®ç›¸æ¯”æš´æ¶¨ã€æµé‡æš´è·Œç­‰ã€‚å¦ä¸€ç§æ˜¯åŸºäºæ—¶é—´åºåˆ—ç®—æ³•æˆ–è€…ç¥ç»ç½‘ç»œçš„æ™ºèƒ½åŒ–æŠ¥è­¦ï¼Œä½¿ç”¨è€…ä¸éœ€è¦å½•å…¥ä»»ä½•è§„åˆ™ï¼Œåªéœ€æœ‰è¶³å¤Ÿé•¿çš„å†å²æ•°æ®ï¼Œå°±å¯ä»¥å®ç°è‡ªåŠ¨æŠ¥è­¦ã€‚æ™ºèƒ½åŒ–æŠ¥è­¦ç›®å‰å‡†ç¡®æ€§ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œåœ¨æ™ºèƒ½åŒ–åŸºç¡€ä¸Šé¢æ·»åŠ å°‘é‡è§„åˆ™å¯èƒ½ä¼šæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚æœæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªçº¿ä¸Šçš„ç½‘ç»œæŠ¥è­¦ï¼Œé€šè¿‡æ¥å…¥å±‚å’Œå®¢æˆ·ç«¯çš„ç›‘æ§æŠ¥è¡¨ï¼Œä¹Ÿä¼šæœ‰äº†ä¸€ä¸ªå¤§è‡´çš„åˆ¤æ–­ã€‚é‚£æ€ä¹ˆæ ·æ‰èƒ½ç¡®å®šé—®é¢˜çš„æœ€ç»ˆåŸå› ï¼Ÿæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‹¿åˆ°ç”¨æˆ·å®Œæ•´çš„ç½‘ç»œæ—¥å¿—ï¼Ÿç”šè‡³è¿œç¨‹åœ°è¯Šæ–­ç”¨æˆ·çš„ç½‘ç»œæƒ…å†µï¼Ÿå…³äºâ€œç½‘ç»œæ—¥å¿—å’Œè¿œç¨‹è¯Šæ–­ï¼Œå¦‚ä½•å¿«é€Ÿå®šä½ç½‘ç»œé—®é¢˜â€ï¼Œæˆ‘ä¼šæŠŠå®ƒå•ç‹¬æˆç¯‡æ”¾åœ¨ä¸“æ ç¬¬äºŒæ¨¡å—é‡Œï¼Œå†æ¥è®²è®²è¿™ä¸ªè¯é¢˜ã€‚</p><h2>æ€»ç»“</h2><p>ç›‘æ§ã€ç›‘æ§åˆæ˜¯ç›‘æ§ï¼Œå¾ˆå¤šæ€§èƒ½ä¼˜åŒ–å·¥ä½œå…¶å®éƒ½æ˜¯â€œä¸‰åˆ†é ä¼˜åŒ–ï¼Œä¸ƒåˆ†é ç›‘æ§â€ã€‚</p><p>ä¸ºä»€ä¹ˆç›‘æ§è¿™ä¹ˆé‡è¦å‘¢ï¼Ÿå¯¹äºå¤§å…¬å¸æ¥è¯´ï¼Œæ¯ä¸€ä¸ªé¡¹ç›®å‚ä¸äººå‘˜å¯èƒ½æˆç™¾ä¸Šåƒäººã€‚å¹¶ä¸”å¤§å…¬å¸è¦çš„ä¸æ˜¯ä»Šå¤©æˆ–è€…è¿™ä¸ªç‰ˆæœ¬å¯ä»¥åšå¥½ä¸€äº›äº‹æƒ…ï¼Œè€Œæ˜¯å¸Œæœ›ä¿è¯æ¯å¤©æ¯ä¸ªç‰ˆæœ¬éƒ½èƒ½æŒç»­ä¿æŒåº”ç”¨çš„é«˜è´¨é‡ã€‚å¦ä¸€æ–¹é¢æœ‰äº†å®Œå–„çš„åˆ†æå’Œç›‘æ§çš„å¹³å°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤æ‚çš„äº‹æƒ…ç®€å•åŒ–ï¼ŒæŠŠä¸€äº›çœ‹èµ·æ¥â€œé«˜ä¸å¯æ”€â€çš„ä¼˜åŒ–å·¥ä½œï¼Œå˜æˆäººäººéƒ½å¯ä»¥åšã€‚</p><p>æœ€åå¤šè°ˆä¸¤å¥æˆ‘çš„æ„Ÿå—ï¼Œæˆ‘ä»¬åœ¨å·¥ä½œçš„æ—¶å€™ï¼Œå¸Œæœ›ä½ å¯ä»¥çœ‹å¾—æ›´è¿œï¼Œä»æ›´é«˜çš„è§’åº¦å»æ€è€ƒé—®é¢˜ã€‚å¤šæƒ³æƒ³å¦‚æœæˆ‘èƒ½åšå¥½è¿™ä»¶äº‹æƒ…ï¼Œæ€ä¹ˆä¿è¯å…¶ä»–äººä¸ä¼šçŠ¯é”™ï¼Œæˆ–è€…è®©æ‰€æœ‰äººéƒ½å¯ä»¥åšå¾—æ›´å¥½ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>å¯¹äºç½‘ç»œé—®é¢˜ï¼Œä½ å°è¯•è¿‡å“ªäº›ç›‘æ§æ–¹æ³•ï¼Ÿæœ‰æ²¡æœ‰ä»¤ä½ å°è±¡æ·±åˆ»çš„ç½‘ç»œæ•…éšœï¼Œæœ€ç»ˆåˆæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼è§£å†³çš„å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€è·Ÿæˆ‘å’Œå…¶ä»–åŒå­¦ä¸€èµ·è®¨è®ºã€‚</p><p>ä»Šå¤©æˆ‘ä»¬ç»ƒä¹ çš„<a href="https://github.com/AndroidAdvanceWithGeektime/Chapter17">Sample</a>æ˜¯é€šè¿‡PLT  Hookï¼Œä»£ç†Socketç›¸å…³çš„å‡ ä¸ªé‡è¦å‡½æ•°ï¼Œè¿™æ¬¡è¿˜å¢åŠ äº†ä¸€ä¸ªä¸€æ¬¡æ€§Hookæ‰€æœ‰å·²ç»åŠ è½½Libraryçš„æ–¹æ³•ã€‚</p><pre><code>int hook_plt_method_all_lib(const char* exclueLibname, const char* name, hook_func hook) {
  if (refresh_shared_libs()) {
    // Could not properly refresh the cache of shared library data
    return -1;
  }
  int failures = 0;
  for (auto const&amp; lib : allSharedLibs()) {
      if (strcmp(lib.first.c_str(), exclueLibname) != 0) {
        failures += hook_plt_method(lib.first.c_str(), name, hook);
      }
  }
  return failures;
}
</code></pre><p>å¸Œæœ›ä½ é€šè¿‡è¿™å‡ æ¬¡è¯¾åç»ƒä¹ ï¼Œå¯ä»¥å­¦ä¼šå°†HookæŠ€æœ¯åº”ç”¨åˆ°å®è·µå½“ä¸­ã€‚</p><p>æ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™å¥½å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ã€‚æœ€ååˆ«å¿˜äº†åœ¨è¯„è®ºåŒºæäº¤ä»Šå¤©çš„ä½œä¸šï¼Œæˆ‘ä¹Ÿä¸ºè®¤çœŸå®Œæˆä½œä¸šçš„åŒå­¦å‡†å¤‡äº†ä¸°åšçš„â€œå­¦ä¹ åŠ æ²¹ç¤¼åŒ…â€ï¼ŒæœŸå¾…ä¸ä½ ä¸€èµ·åˆ‡ç£‹è¿›æ­¥å“¦ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/bf/f1/bf8fdc35ddccb10b1161d8ca7eb8f8f1.jpg" alt=""></p>
                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/56/25/ba0e44af.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">æ’</span>
                            </div>
                            <div class="bd">ç”±äºæœ€è¿‘è¿™å‡ å¹´éƒ½æ˜¯åœ¨åšè·Ÿç½‘ç»œç›¸å…³çš„å·¥ä½œï¼ŒåŸºæœ¬ä¸Šé‡åˆ°çš„é—®é¢˜ç»æ–‡è€å¸ˆéƒ½å·²ç»æåˆ°äº†ã€‚æ¯”å¦‚DNSåŠ«æŒï¼Œè¶…æ—¶ï¼ŒæœåŠ¡å™¨å®•æœºã€å‡ç½‘ã€ç™½åå•ç­‰ç½‘ç»œé—®é¢˜ã€‚å…¶ä¸­è®©æˆ‘å°è±¡æœ€ä¸ºæ·±åˆ»çš„æ˜¯å…¬å¸å†…éƒ¨çš„wifiä¸Šç½‘è®¤è¯ï¼Œæ²¡æœ‰é€šè¿‡è®¤è¯æ˜¯æ— æ³•è®¿é—®å†…ç½‘å’Œå¤–ç½‘ã€‚  æœ€åè§£å†³è¿™ç±»é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸»åŠ¨ç”¨æµè§ˆå™¨æ‰“å¼€è®¤è¯é¡µé¢è®©ç”¨æˆ·ç™»å½•ã€‚<br>  <br></div>
                            <span class="time">2019-01-28 18:12</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">zzb226520</span>
                            </div>
                            <div class="bd">åœ¨okhttpä¸­ç»Ÿè®¡å»ºç«‹è¿æ¥è€—æ—¶ï¼ŒSSLæ¡æ‰‹è€—æ—¶ï¼Œç„¶åä¸ºäº†ç¡®å®šç»Ÿè®¡æ­£ç¡®ï¼Œç”¨äº†ç”µè„‘ä¸Šwiresharkè¿›è¡Œå­ç›¸åº”è¿‡ç¨‹çš„è€—æ—¶æ¯”è¾ƒã€‚<br><br>å‘ç°ï¼Œokhttpä¸­çš„æ–¹æ³•è€—æ—¶æ¯”wiresharkç»Ÿè®¡çš„è€—æ—¶å¤§å¾ˆå¤šï¼Œæ¯”å¦‚okhttpä¸­å¯¹SSLæ¡æ‰‹æ–¹æ³•socket.startHandSharke()çš„è€—æ—¶å¯èƒ½180msï¼Œä½†æ˜¯wireshakæ˜¾ç¤ºè¿™ä¸€æ­¥åªæœ‰40-50msã€‚<br><br>æœ‰äººåšè¿‡ç±»ä¼¼ç»Ÿè®¡å—ï¼Ÿä¸ºä»€ä¹ˆè·Ÿç”µè„‘æŠ“åŒ…å¯¹æ¯”è€—æ—¶ç»Ÿè®¡æ•°æ®ä¼šå·®è¿™ä¹ˆå¤šï¼Ÿéš¾é“startHandSharke()ä¸åªåšæ˜¯SSLçš„æ¡æ‰‹çš„äº‹ï¼Œè¿˜æœ‰åˆ«çš„äº‹åœ¨è€—æ—¶ï¼Ÿ<br> <br></div>
                            <span class="time">2019-01-25 11:19</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLlyJ6ricobic7OdzAUNkbNpdadtZ87ILUyibpcOb3eRicuHPrzLzefza7fdYS2iaBLseccsqeib8WLeKOg/132" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">csdpz</span>
                            </div>
                            <div class="bd">æˆ‘å¸çš„appåœ¨2018å¹´æœ‰ä¸€é˜µå­æœ‰ç”¨æˆ·æŒç»­åé¦ˆç½‘ç»œå¡é¡¿ã€‚ç»ˆäºèŠ±äº†ç‚¹åŠ›æ°”å®Œå–„äº†ç›‘æ§ã€‚å› ä¸ºä¸»è¦æ˜¯åé¦ˆçš„socketé‚£å—çš„ä¸šåŠ¡ï¼Œæ‰€ä»¥å¯¹socketè¯·æ±‚æ”¶å‘æµç¨‹åˆ†ä¸º7ä¸ªé˜¶æ®µè¿›è¡Œäº†ç›‘æ§ï¼Œåˆ†åˆ«æ˜¯ï¼šè¯·æ±‚è°ƒç”¨ï¼Œè¯·æ±‚å…¥é˜Ÿåˆ—ï¼Œè¯·æ±‚å¼€å§‹å‘é€ï¼Œè¯·æ±‚å‘é€æˆåŠŸï¼Œæ”¶åˆ°å“åº”ï¼Œå“åº”å…¥é˜Ÿåˆ—ï¼Œå“åº”æ•°æ®è§£æåˆ†å‘ã€‚<br><br>å½“ç„¶é™¤äº†å®¢æˆ·ç«¯ç›‘æ§æ•°æ®å¤–ï¼Œè¿˜å’ŒæœåŠ¡å™¨æ•°æ®æ•´åˆäº†ï¼Œèƒ½æ›´åŠ å‡†ç¡®çœ‹åˆ°å¡é¡¿çš„å æ¯”ã€‚<br><br>å®¢æˆ·ç«¯ç”¨çš„æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…åŠ é˜»å¡é˜Ÿåˆ—çš„æ¨¡å¼ã€‚é‡åˆ°äº†Tcpé˜Ÿå¤´é˜»å¡çš„é—®é¢˜ã€‚ä¸€æ—¦è¿›ä¸ªç”µæ¢¯æˆ–è€…åœ°ä¸‹å®¤ï¼Œå‡ºç°äº†å¼±ç½‘æƒ…å†µï¼Œè¯·æ±‚å¼€å§‹å‘é€å’Œè¯·æ±‚å‘é€æˆåŠŸçš„æ—¶é—´å·®å°±ä¼šæ€¥å‰§æ”¾å¤§ï¼Œè€Œè¿™ä¸¤ä¸ªæ—¶é—´æ®µä¹‹é—´ä»…ä»…åªæœ‰ä¸€è¡Œout.write(data)ã€‚å‰é¢ä¸€ä¸ªæ²¡å‘å®Œï¼Œé˜Ÿåˆ—é‡Œçš„éƒ½è¢«å µä½äº†ã€‚<br><br>åæ¥ï¼Œå‡†å¤‡å°è¯•Nioçš„æ–¹å¼ï¼ŒæŠŠè¯·æ±‚å‘é€çš„æ—¶é—´ç»™å‹ä¸‹å»ï¼Œä½†åæ¥æƒ³æƒ³æ•°æ®å¥½çœ‹äº†ï¼Œå¹¶ä¸è§£å†³å®é™…é—®é¢˜ï¼Œå‘ä¸å‡ºå»è¿˜æ˜¯å‘ä¸å‡ºå»ï¼Œäºæ˜¯ä½œç½¢ã€‚<br><br>ä¹Ÿæƒ³é—®é—®å„ä½å¤§ä½¬ï¼Œæœ‰æ²¡æœ‰å¥½çš„å»ºè®®ï¼Ÿ<br><br><br> <br></div>
                            <span class="time">2019-01-25 00:36</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/04/c8/68263086.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å“ˆç€æœ‹å‹</span>
                            </div>
                            <div class="bd">è€å“¥æ˜¯ä¸æ˜¯å‚åŠ äº†Buglyé¡¹ç›® <br></div>
                            <span class="time">2019-01-24 15:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">æ²¡æœ‰å•Š</p>
                                <p class="reply-time">2019-01-25 17:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/87/2c/037d64a1.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">åšæŒè¿œæ–¹</span>
                            </div>
                            <div class="bd">åˆ›ä¸šå…¬å¸æ•´å¤©å¿™äºåšä¸šåŠ¡ï¼Œå¯¹äºç›‘æ§è¿™äº›åšçš„è¿˜æ˜¯ä¸å¤Ÿï¼Œæ‰€ä»¥ç›®å‰Appå¹¶æ²¡æœ‰ç›‘æ§æ–¹é¢çš„ä¸œè¥¿ï¼Œä½†æ˜¯è·Ÿç€ä½œè€…çš„æ­¥éª¤è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤š <br></div>
                            <span class="time">2019-01-24 14:35</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/d9/2d/ca99e374.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Owen</span>
                            </div>
                            <div class="bd">å¹²è´§å¤šå¤šï¼Œåœ¨è¿™é‡Œæƒ³äº†è§£ä¸‹å¤§å®¶éƒ½æœ‰ç”¨å“ªäº›ç½‘ç»œåº“ï¼Ÿ <br></div>
                            <span class="time">2019-01-24 09:16</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/ed/af/4a43ac25.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">ç¨»å­</span>
                            </div>
                            <div class="bd">ğŸ›‹ <br></div>
                            <span class="time">2019-01-24 00:53</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>